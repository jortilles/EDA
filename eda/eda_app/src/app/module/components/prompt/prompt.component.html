<div class="chat-wrapper">
    <div class="chat-header">
        <h4>Consulta: </h4>
    </div>

    <div class="chat-messages" #messagesContainer>
        <div *ngFor="let m of messages" [ngClass]="{'msg-user': m.role==='user', 'msg-assistant': m.role==='assistant', 'msg-system': m.role==='system', 'msg-error': m.role==='error'}" class="chat-message">
            <div class="bubble">
                <pre class="msg-content">{{ m.content }}</pre>
                <div class="msg-meta">{{ m.role }} · {{ m.timestamp | date:'shortTime' }}</div>

                <!-- Botón copiar, solo para mensajes de usuario -->
                <button *ngIf="m.role==='user'" 
                        class="copy-btn" 
                        (click)="copyMessage(m)">

                    <!-- Icono de dos cuadrados y de check cuando se copia el texto-->
                    <svg *ngIf="!m.copied" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2m-6 12h8a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-8a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2z"/>
                    </svg>

                    <!-- Check -->
                    <svg *ngIf="m.copied" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                    </svg>

                </button>
            </div>
        </div>

        <!-- Escribiendo -->
        @if(loading){
            <div class="chat-message msg-assistant">
                <div class="bubble">
                    <div class="text-gray-500 text-base italic animate-pulse break-words max-w-[100%] overflow-x-hidden">
                        <span i18n="@@escribiendo">Escribiendo...</span>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="chat-input">
        <textarea [(ngModel)]="inputText" (keydown)="onKeydown($event)" placeholder="Escribe un mensaje..." rows="2"></textarea>
        <button (click)="sendMessage()" [disabled]="sending || !inputText.trim()">{{ sending ? 'Enviando...' : 'Enviar' }}</button>
    </div>
</div>