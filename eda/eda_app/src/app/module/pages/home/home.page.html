<div class="flex-1 w-full min-h-screen">
  <div class="max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-8 space-y-6 py-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      <div class="flex items-center gap-2">
        <eda-icon name="home" class="text-[#00B0BA]" />
        <h1 class="text-2xl font-semibold" i18n="@@homeTitle">Mis informes</h1>
      </div>
      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 w-full sm:w-auto">
        <div class="relative w-full sm:w-[300px]">
          <eda-icon name="magnifying-glass"
            class="absolute left-3 top-1/2 h-4 w-4 -translate-y-[65%] text-muted-foreground" />
          <input type="text" (keyup)="filterByTitle($event)"
            class="w-full rounded-md border border-input bg-background py-2 !pl-9 text-sm"
            i18n-placeholder="@@searcherInput" placeholder="Buscador">
        </div>
        <button
          class="bg-gradient-to-r from-[#00B0BA] to-teal-400 text-white font-bold px-4 py-2 rounded flex items-center"
          (click)="onCreateDashboard()">
          <eda-icon name="plus" size="sm" class="h-4 mr-2" />
          <span i18n="@@tituloNuevoInforme">Crear nuevo informe</span>
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4" style="overflow-wrap:anywhere"> <!-- Filtros -->
      <div class="flex-1 min-w-0">
        <div class="text-sm text-muted-foreground"> <span i18n="@@filterReports">FILTRAR INFORMES:</span> </div>
        <!-- Contenedor de tags -->
        <div class="flex flex-wrap items-center gap-2 overflow-hidden"> <span
            class="flex items-center px-4 py-2 text-sm text-gray-700">Tags:</span> @for (option of filteredTags(); track
          option.value) { <div [ngClass]="isTagSelected(option.value) ? 'tag-selected' : 'tag'"
            (click)="handleTagSelect(option)"> {{ option.label }} </div> } </div>
      </div> <!-- Ordenar informes -->
      <div class="w-full sm:w-auto flex-shrink-0">
        <div class="text-sm text-muted-foreground" i18n="@@sortReports">ORDENAR INFORMES:</div> <select
          class="w-full sm:w-[180px] rounded-md border border-input bg-background px-3 py-2 text-sm"
          [(ngModel)]="sortingType" (change)="handleSorting()">
          <option value="name" i18n="@@name">Nombre</option>
          <option value="dateAsc" i18n="@@createdAt">Fecha (asc.)</option>
          <option value="dateDesc" i18n="@@createdAtDesc">Fecha (desc.)</option>
        </select>
      </div>
    </div>

    <!-- Categories -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Public Reports -->
      <ng-container
        *ngTemplateOutlet="reportsTemplate; context: { reports: sharedReports, title: publicTitle }"></ng-container>

      <!-- Commons -->
      <ng-container
        *ngTemplateOutlet="reportsTemplate; context: { reports: publicReports, title: commonTitle }"></ng-container>

      <!-- Groups -->
      <ng-container
        *ngTemplateOutlet="reportsTemplate; context: { reports: roleReports, title: groupTitle }"></ng-container>

      <!-- Private -->
      <ng-container
        *ngTemplateOutlet="reportsTemplate; context: { reports: privateReports, title: privateTitle }"></ng-container>
    </div>
  </div>
</div>


<!-- Template report card -->
<ng-template #reportsTemplate let-reports="reports" let-title="title">
  <div class="space-y-4">
    <h2 class="text-lg font-semibold">{{ title }}</h2>
    @for (report of reports; track report._id) {
    <div class="rounded-lg border bg-card text-card-foreground shadow-sm" [attr.id]="'dashboard-' + report._id">
      <div class="px-4 py-2 cursor-pointer" (mousedown)="openReport(report, $event)">
        @if(!isEditing || editingReportId !== report._id){
        <h3 class="text-base font-semibold">
          {{ report.config?.title }}
        </h3>
        }@else {
        <input class="edit-title-input text-base font-semibold px-2 py-1" [(ngModel)]="editTitle"
          (blur)="handleEditing('done', report)" (keydown.enter)="handleEditing('done', report)"
          (keydown.escape)="handleEditing('cancel', report)" (click)="$event.stopPropagation()" autofocus />
        }
      </div>
      <div class="grid grid-cols-3 items-center border-t px-4 py-2 gap-2">
        <div class="text-sm text-muted-foreground truncate min-w-0">
          @if (report.config?.author && report.config?.author != 'Undefined') {
          <span class="truncate block" [title]="report.config.author">{{report.config.author}}</span>
          }
        </div>
        <div class="text-sm text-muted-foreground text-center">
          @if (report.config?.modifiedAt) {
          <span>{{report.config.modifiedAt}}</span>
          }
        </div>
        <div class="flex items-center justify-end">
          @if(report.config.visible=='shared' || report.config.visible=='open' ){
            <button class="rounded-md p-1 cursor-pointer hover:bg-muted" (click)="copyReport(report)">
              <eda-icon name="export" class="mr-1"></eda-icon>
            </button>
          }

          @if (!isEditing || editingReportId !== report._id) {
          <button class="rounded-md p-1 cursor-pointer hover:bg-muted" (click)="renameReport(report)">
            <eda-icon name="pencil" class="mr-1"></eda-icon>
          </button>
          }@else {
          <button class="rounded-md p-1 cursor-pointer hover:bg-muted" (click)="handleEditing('done', report)">
            <eda-icon name="check" class="mr-1"></eda-icon>
          </button>
          }

          <button class="rounded-md p-1 cursor-pointer hover:bg-muted" (click)="cloneReport(report)">
            <eda-icon name="document-duplicated"></eda-icon>
          </button>
          <button class="rounded-md p-1 cursor-pointer hover:bg-muted" (click)="deleteReport(report)">
            <eda-icon name="bin"></eda-icon>
          </button>
        </div>
      </div>
    </div>
    }
    @empty {
    <div class="mt-4 rounded-lg bg-muted p-4 text-center text-muted-foreground">
      <span i18n="@@withoutContentYet">Sin contenido</span>
    </div>
    }
  </div>
</ng-template>


<!-- <app-create-dashboard></app-create-dashboard> -->