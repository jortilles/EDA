<div class="container mx-auto my-10 py-10 px-4 bg-background rounded-lg">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold tracking-tight">Gestión de Usuarios</h1>
    <button (click)="handleCreateUser()" class="bg-[#00BFB3] hover:bg-[#00BFB3]/90 px-4 py-2 rounded font-semibold text-white flex items-center">
      <eda-icon name="plus" class="mr-2"></eda-icon>
      Crear Usuario
    </button>
  </div>

  <div class="flex items-center mb-6">
    <input [(ngModel)]="searchTerm" placeholder="Buscar usuarios..." class="border p-2 rounded w-full" />
  </div>

  <div class="border rounded-lg overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-100">
        <tr>
          <th (click)="handleSort('email')" class="cursor-pointer p-3">Email</th>
          <th (click)="handleSort('name')" class="cursor-pointer p-3">Nombre</th>
          <th (click)="handleSort('role')" class="cursor-pointer p-3">Grupo</th>
          <th class="p-3 text-right">Acciones</th>
        </tr>
      </thead>
      <tbody class="font-semibold">
        @for (user of paginatedUsers; track user._id) {
        <tr>
          <td class="p-3">{{ user.email }}</td>
          <td class="p-3">{{ user.name }}</td>
          <td class="p-3">
            <span [ngClass]="{'bg-[#00BFB3] text-white px-2 py-1 rounded': user.role === 'EDA_ADMIN'}">
              {{ user.role }}
            </span>
          </td>
          <td class="p-3 text-right">
            <button class="rounded-md p-2 cursor-pointer hover:bg-muted" (click)="handleEditUser(user)">
              <eda-icon name="pencil"></eda-icon>
            </button>
            <button class="rounded-md p-2 cursor-pointer hover:bg-muted" (click)="handleDeleteUser(user._id)">
              <eda-icon name="bin"></eda-icon>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  <p class="mt-1 font-semibold text-right text-gray-500">{{ filteredUsers.length }} usuarios encontrados</p>
  <div class="flex justify-center items-center gap-2 mt-4">
    <button (click)="setPage(currentPage - 1)" [disabled]="currentPage === 1" class="px-4 py-2 font-semibold rounded">
      <eda-icon name="chevron-left"></eda-icon>
    </button>
    <span class="font-semibold">Página {{ currentPage }} de {{ totalPages() }}</span>
    <button (click)="setPage(currentPage + 1)" [disabled]="currentPage === totalPages()" class="px-4 py-2 font-semibold rounded">
      <eda-icon name="chevron-right"></eda-icon>
    </button>
  </div>
</div>


<eda-dialog2 *ngIf="showUserDetail"
  [display]="showUserDetail"
  [header]="!selectedUser.isnew ? 'Editar Usuario' : 'Crear Nuevo Usuario'"
  width="50vw" height="auto"
  (close)="showUserDetail = false;"
  (apply)="onApplyUserDetail()">
  
  <div content>
    <div class="mt-4">
      <label class="block text-sm font-medium">Nombre</label>
      <input [(ngModel)]="selectedUser.name" class="w-full border p-2 rounded mt-1" />

      <label class="block text-sm font-medium mt-2">Email</label>
      <input [(ngModel)]="selectedUser.email" class="w-full border p-2 rounded mt-1" />

      <label class="block text-sm font-medium mt-2">Contraseña</label>
      <input type="password" class="w-full border p-2 rounded mt-1" />

      <label class="block text-sm font-medium mt-2">Grupo</label>
      <select [(ngModel)]="selectedUser.role" class="w-full border p-2 rounded mt-1">
        <option value="EDA_ADMIN_ROLE">ADMIN</option>
        <option value="EDA_USER_ROLE">USER</option>
      </select>
    </div>
  </div>
</eda-dialog2>