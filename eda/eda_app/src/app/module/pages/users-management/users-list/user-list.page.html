<div class="container mx-auto my-10 py-10 px-4 bg-background rounded-lg">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold tracking-tight" i18n="@@adminUsers">Gestión de Usuarios</h1>
    <button (click)="handleCreateUser()" class="bg-[#00BFB3] hover:bg-[#00BFB3]/90 px-4 py-2 rounded font-semibold text-white flex items-center">
      <eda-icon name="plus" class="mr-2"></eda-icon>
      <span i18n="@@addUser">Crear Usuario</span>
    </button>
  </div>

  <div class="flex items-center mb-6">
    <input [(ngModel)]="searchTerm" (ngModelChange)="currentPage = 1" i18n-placeholder="@@searchUsers" placeholder="Buscar usuarios..." class="border p-2 rounded w-full" />
  </div>

  <div class="border rounded-lg overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-100">
        <tr>
          <th (click)="handleSort('email')" class="text-left cursor-pointer p-3" i18n="@@email">Correo</th>
          <th (click)="handleSort('name')" class="text-left cursor-pointer p-3" i18n="@@name">Nombre</th>
          <th (click)="handleSort('role')" class="text-left cursor-pointer p-3" i18n="@@group">Grupo</th>
          <th class="p-3 text-right" i18n="@@actions">Acciones</th>
        </tr>
      </thead>
      <tbody class="font-semibold">
        @for (user of paginatedUsers; track user._id) {
        <tr>
          <td class="p-3">{{ user.email }}</td>
          <td class="p-3">{{ user.name }}</td>
          <td class="p-3">
            <span [ngClass]="{'bg-[#00BFB3] text-white px-2 py-1 rounded': user.role === 'EDA_ADMIN'}">
              {{ user.role }}
            </span>
          </td>
          <td class="p-3 text-right">
            <button class="rounded-md p-2 cursor-pointer hover:bg-muted" (click)="handleEditUser(user)">
              <eda-icon name="pencil"></eda-icon>
            </button>
            <button class="rounded-md p-2 cursor-pointer hover:bg-muted" (click)="handleDeleteUser(user._id)">
              <eda-icon name="bin"></eda-icon>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  <p class="mt-1 font-semibold text-right text-gray-500">{{ filteredUsers.length }} <span i18n="@@foundUsers">usuarios encontrados</span></p>
  <div class="flex justify-center items-center gap-2 mt-4">
    <button (click)="setPage(currentPage - 1)" [disabled]="currentPage === 1" class="px-4 py-2 font-semibold rounded">
      <eda-icon name="chevron-left"></eda-icon>
    </button>
    <span class="font-semibold"> <span i18n="@@tablePage">Página</span> {{ currentPage }} <span i18n="@@tablePageOf">de</span> {{ totalPages() }}</span>
    <button (click)="setPage(currentPage + 1)" [disabled]="currentPage === totalPages()" class="px-4 py-2 font-semibold rounded">
      <eda-icon name="chevron-right"></eda-icon>
    </button>
  </div>
</div>


<eda-dialog2 *ngIf="showUserDetail"
  [display]="showUserDetail"
  [header]="!selectedUser.isnew ? updateUserTitle : addUserTitle"
  width="50vw" height="75vh"
  (close)="showUserDetail = false;"
  (apply)="onApplyUserDetail()">
  
  <div content>
    <div class="mt-4">
      <label class="block text-sm font-medium" i18n="@@name">Nombre</label>
      <input [(ngModel)]="selectedUserApply.name" class="w-full border p-2 rounded mt-1" />

      <label class="block text-sm font-medium mt-2" i18n="@@email">Correo</label>
      <input [(ngModel)]="selectedUserApply.email" class="w-full border p-2 rounded mt-1" />

      <label class="block text-sm font-medium mt-2" i18n="@@password">Contraseña</label>
      <input type="password" [(ngModel)]="selectedUserApply.password" class="w-full border p-2 rounded mt-1" />

      <label class="block text-sm font-medium mt-2" i18n="@@group">Grupo</label>
      <p-multiSelect [(ngModel)]="selectedUserApply.role" [options]="groups" optionLabel="name" optionValue="name" i18n-defaultLabel="@@groupSelect"
        defaultLabel="Selecciona..."
        [style]="{width: '100%'}"
        class="w-full border rounded mt-2">
      </p-multiSelect>
  </div>
</div>
</eda-dialog2>